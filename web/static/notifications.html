<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
</head>

<body>
    <h1>Agent notifications demo</h1>
    <p>Notifications will appear in the list below</p>
    <ul id="list"></ul>
<script>
    (async () => {
        const response = await fetch('http://localhost:8080/v1/notifications/event-stream', {
            headers: {
                'X-Optimizely-Sdk-Key': '9LCprAQyd1bs1BBXZ3nVji',
            },
        });
        if (response.status !== 200) {
            console.error('Request error');
            response.body.cancel();
            return;
        }

        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        while (true) {
            const { done, value } = await reader.read();
            console.log('message: ', value);
            const text = decoder.decode(value, { stream: true });
            console.log('text: ', text);
            const newElement = document.createElement('li');
            const eventList = document.getElementById('list');
            newElement.innerHTML = text;
            document.querySelector('#list').appendChild(newElement);
            if (done) {
                console.log('done');
                break;
            }
        }
    })();
</script>
</body>
</html>
